---
# Set up LVM and LXC

- name: Installing tools
  apt: name={{ item }}
       update_cache=yes
       state=latest
  with_items:
      - "dmsetup"
      - "lvm2"
      - "lxc"
      - "libvirt-bin"
      - "bridge-utils"

- name: Setting up LVM physical volumes
  command: "pvcreate {{ lvm_pv }}"
  ignore_errors: yes

- name: Settung up LVM groups
  lvg: vg=LXCVolume pvs={{ lvm_pv }}
  ignore_errors: yes

- name: Creating Development LVM Volume
  lvol: vg=LXCVolume
        lv=development
        size={{ lxcd_size }}
  ignore_errors: yes

- name: Creating Production LVM Volume
  lvol: vg=LXCVolume
        lv=production
        size={{ lxcp_size }}
  ignore_errors: yes

# - name: Creating mount points
#  command: "mkdir /var/lib/lxc/production /var/lib/lxc/development"
#  ignore_errors: yes

- name: Creating LXC containers
  command: "lxc-create -n production -t debian -- -r jessie"
