---
# Set up LVM for containers

- name: Setting up LVM physical volumes
  command: "pvcreate {{ lvm_pv }}"
  ignore_errors: yes

- name: Settung up LVM groups
  lvg: vg=lxc pvs={{ lvm_pv }}
  ignore_errors: yes

- name: Setting up LVM volumes
  lvol: lv={{ item }} 
        vg=lxc
        size={{ lvm_size }}
        state=present
  with_items:
    - "{{ containers }}"

- name: Creating file systems
  filesystem: dev=/dev/lxc/{{ item }}
              fstype={{ containers_fs }}
              opts={{ containers_fs_opts }}
  with_items:
    - "{{ containers }}"

- name: Creating directories
  file: path=/var/lib/lxc/{{ item }}/rootfs state=directory
  with_items:
    - "{{ containers }}"

- name: Creating fstab entries
  mount: name=/var/lib/lxc/{{ item }}/rootfs 
         src=/dev/lxc/{{ item }} 
         fstype={{ containers_fs }}
         state=present
  with_items:
    - "{{ containers }}"

- name: Mounting
  mount: name=/var/lib/lxc/{{ item }}/rootfs 
         src=/dev/lxc/{{ item }} 
         fstype={{ containers_fs }}
         state=mounted
  with_items:
    - "{{ containers }}"


